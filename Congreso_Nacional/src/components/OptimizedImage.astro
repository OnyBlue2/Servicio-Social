---
interface Props {
  src: string;
  alt: string;
  width?: number;
  height?: number;
  class?: string;
  loading?: 'lazy' | 'eager';
  quality?: number;
}

const { 
  src, 
  alt, 
  width = 400, 
  height = 300, 
  class: className = '', 
  loading = 'lazy',
  quality = 80
} = Astro.props;

// Construir la ruta correcta - simple y efectiva
const imageSrc = src.startsWith('/') ? src : `/${src}`;
---

<div class={`image-container ${className}`}>
  <img 
    src={imageSrc}
    alt={alt}
    width={width}
    height={height}
    loading={loading}
    class="optimized-image"
    decoding="async"
  />
</div>

<style>
  .image-container {
    position: relative;
    overflow: hidden;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
  }

  .optimized-image {
    width: auto;
    height: auto;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transition: transform 0.3s ease, filter 0.3s ease;
    filter: brightness(1) contrast(1.05) saturate(1.1);
  }

  .image-container:hover .optimized-image {
    transform: scale(1.05);
    filter: brightness(1.05) contrast(1.1) saturate(1.15);
  }

  /* Shimmer loading effect */
  .optimized-image[loading="lazy"] {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }

  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }

  .optimized-image[data-loaded="true"] {
    animation: none;
    background: none;
  }
</style>

<script>
  // Add loaded state for better UX
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('.optimized-image');
    images.forEach(img => {
      if (img.complete) {
        img.setAttribute('data-loaded', 'true');
      } else {
        img.addEventListener('load', () => {
          img.setAttribute('data-loaded', 'true');
        });
      }
    });
  });
</script>